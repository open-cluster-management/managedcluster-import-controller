# Importing an existing cluster using the cluster controller

## Creating a ClusterRegistry Cluster

- example of ClusterRegistry cluster test/resources/test_cluster.yaml
- refer to <https://github.com/kubernetes/cluster-registry/blob/master/pkg/apis/clusterregistry/v1alpha1/types.go> for API defination

## Creating a Multicloud EndpointConfig for the cluster you are importing

- example of EndpointConfig resource refer to test/resources/test_endpoint_config.yaml
- refer to apis/multicloud/v1alpha1/endpointconfig_types.go and apis/multicloud/v1beta1/endpoint_types.go for API defination

## ClusterController actions

- EndpointConfig creation triggers Reconcile() in `pkg/controllers/endpointconfig/endpointconfig_controller.go`.
- Controller will use information in EndpointConfig to generate a secret named `{cluster-name}-import`.
- The `{cluster-name}-import` secret contains the import.yaml that the user will apply on managed cluster to install multicluster-endpoint.

## Obtaining the import.yaml generated by the cluster controller

- MacOS X

```bash
kubectl get secret ${cluster_name}-import -n ${cluster_namespace} -o jsonpath={.data.import\\.yaml} | base64 -D > import.yaml
```

- Linux

```bash
kubectl get secret ${cluster_name}-import -n ${cluster_namespace} -o jsonpath={.data.import\\.yaml} | base64 -d > import.yaml
```

## Installing multicluster-endpoint on managed cluster

- Authenticate to your managed cluster
- Apply the import.yaml generated in previous step with `kubectl apply -f import.yaml`
